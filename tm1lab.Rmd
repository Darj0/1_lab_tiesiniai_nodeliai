---
title: "1lab"
author: "vilte"
date: "2025-09-22"
output:
  word_document: default
  pdf_document: default
---

# ------------------- Bibliotekos -------------------
```{r}
library(nortest)    # Anderson-Darling testui
library(MASS)       # boxcox, stepAIC
library(car)        # qqPlot
library(corrplot)   # koreliacijos grafikai
library(ggplot2)    # grafikai
library(dplyr)      # rename
library(plyr)       # revalue
```

# ------------------- 1. Duomenų skaitymas -------------------
```{r}
#data <- read.csv("/Users/darjabaranova/Documents/VU/3_kursas/tiesiniai_metodai/salary_prediction_data.csv", stringsAsFactors = FALSE)
data <- read.csv("/Users/vilte/Desktop/salary_prediction_data.csv",
                 stringsAsFactors = FALSE)
```

# 2. Kategorinių kintamųjų nustatymas
```{r}
data$Education <- factor(data$Education)
data$Education <- revalue(data$Education,
                         c("High School" = "Vidurinis išsilavinimas",
                           "Bachelor" = "Bakalauro laipsnis",
                           "Master" = "Magistro laipsnis",
                           "PhD" = "Daktaro laipsnis"))

data$Location <- factor(data$Location)
data$Location <- revalue(data$Location,
                         c("Rural" = "Kaimas",
                           "Suburban" = "Priemiestis",
                           "Urban" = "Miestas"))

data$Job_Title <- factor(data$Job_Title)
data$Job_Title <- revalue(data$Job_Title,
                         c("Manager" = "Vadovas",
                           "Director" = "Direktorius",
                           "Analyst" = "Analitikas",
                           "Engineer" = "Inžinierius"))

data$Gender <- factor(data$Gender)
data$Gender <- revalue(data$Gender,
                          c("Female" = "Moteris",
                            "Male" = "Vyras"))
data$Gender_num <- ifelse(data$Gender == "Moteris", 1, 0)  # kiekybinė lytis koreliacijai
```


# ------------------- 2. Pradinė kintamojo "Salary" analizė -------------------
```{r}
summary(data$Salary)

data$Salary <- data$Salary / 1000  
```

# ------------------- 3. Normalumo testai -------------------
# Kolmogorovo–Smirnovo testas
```{r}
ks.test(data$Salary, "pnorm", mean = mean(data$Salary), sd = sd(data$Salary))
```


# Histogramos su tankio linija
```{r}
options(scipen = 999)
hist(data$Salary, breaks=30, freq=FALSE, col="darkgray",
     main="Atlyginimo histograma", xlab="Atlyginimas (USD tūkst.)", ylab="Tankis")
x_vals <- seq(min(data$Salary), max(data$Salary), length.out=100)
lines(x_vals, dnorm(x_vals, mean=mean(data$Salary), sd=sd(data$Salary)), col="red", lwd=2)
```

```{r}
# QQ grafikas
qqPlot(data$Salary, dist = "norm",
       main = "QQ grafikas: atlyginimas",
       xlab = "Teoriniai kvantiliai", ylab = "Stebėti atlyginimai (tūkst.)")
```

# ------------------- 4. Koreliacija (kiekybiniai kintamieji) -------------------
```{r}
data$Education_ord <- as.numeric(factor(data$Education, 
                                        levels = c("Vidurinis išsilavinimas", "Bakalauro laipsnis", "Magistro laipsnis", "Daktaro laipsnis"),
                                        ordered = TRUE))

data$Job_Title_ord <- as.numeric(factor(data$Job_Title,
                                        levels = c("Analitikas", "Direktorius", "Inžinierius", "Vadovas"),
                                        ordered = TRUE))

num_vars <- data[, c("Salary", "Experience", "Age", "Gender_num", "Education_ord", "Job_Title_ord")]
cor_matrix <- cor(num_vars, use = "complete.obs")

vardai_lt <- c(
  "Atlyginimas (USD tūkst.)",
  "Darbo patirtis (m.)",
  "Amžius (m.)",
  "Lytis (moteris = 1)",
  "Išsilavinimas (ord.)",
  "Pareigos (ord.)"
)

colnames(cor_matrix) <- vardai_lt
rownames(cor_matrix) <- vardai_lt

corrplot(cor_matrix, method = "number", type = "upper",
         tl.col = "black", tl.srt =45 , number.cex = 0.9)

```
# ------------------- 5. Stačiakampės diagramos -------------------
```{r}
mano_tema <- theme_minimal(base_size=14) +
  theme(
    axis.ticks = element_line(color="black"),
    axis.ticks.length = unit(5, "pt"),
    axis.line.x = element_line(color="black"),
    axis.line.y = element_line(color="black"),
    plot.title = element_text(hjust=0.5)
  )

# Išsilavinimas
ggplot(data, aes(x=Education, y=Salary, fill=Education)) +
  geom_boxplot() +
  labs(
    title = "Atlyginimas pagal išsilavinimą",
    x = "Išsilavinimas", 
    y = "Atlyginimas (USD tūkst.)",
    fill = "Išsilavinimo lygis"
  ) +
  mano_tema
```

```{r}
# Vietovė
ggplot(data, aes(x=Location, y=Salary, fill=Location)) +
  geom_boxplot() +
  labs(title="Atlyginimas pagal vietovę",
       x="Vietovė",
       y="Atlyginimas (USD tūkst.)",
       fill = "Gyvenamoji vietovė"
  ) +
  mano_tema
```

```{r}
# Pareigos
ggplot(data, aes(x=Job_Title, y=Salary, fill=Job_Title)) +
  geom_boxplot() +
  labs(title="Atlyginimas pagal pareigas",
       x="Pareigos",
       y="Atlyginimas (USD tūkst.)",
       fill = "Darbo pareigos"
  ) +
  mano_tema
```

```{r}
# Lytis
ggplot(data, aes(x=Gender, y=Salary, fill=Gender)) +
  geom_boxplot() +
  labs(title="Atlyginimas pagal lytį",
       x="Lytis",
       y="Atlyginimas (USD tūkst.)",
       fill = "Lytis"
  ) +
  mano_tema
```

```{r}
# 95% PI (mean ± 1.96*SE)
mean_ci95 <- function(x, conf = 0.95) {
  x <- x[!is.na(x)]
  m  <- mean(x)
  se <- sd(x) / sqrt(length(x))
  z  <- qnorm(1 - (1 - conf)/2)
  data.frame(y = m, ymin = m - z*se, ymax = m + z*se)
}

# ── Išsilavinimas
ggplot(data, aes(x = Education, y = Salary)) +
  stat_summary(fun = mean, geom = "point", size = 4, color = "blue") +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15, color = "black") +
  scale_x_discrete(limits = c("Vidurinis išsilavinimas", "Bakalauro laipsnis", "Magistro laipsnis", "Daktaro laipsnis")) +
  labs(title = "Vidurkiai ir 95% PI pagal išsilavinimą",
       x = "Išsilavinimas", y = "Atlyginimas (USD tūkst.)") +
  mano_tema
```

```{r}
# ── Vietovė
ggplot(data, aes(x = Location, y = Salary)) +
  stat_summary(fun = mean, geom = "point", size = 4, color = "blue") +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15) +
  labs(title = "Vidurkiai ir 95% PI pagal vietovę",
       x = "Vietovė", y = "Atlyginimas (USD tūkst.)") +
  mano_tema
```

```{r}
# ── Pareigos
ggplot(data, aes(x = Job_Title, y = Salary)) +
  stat_summary(fun = mean, geom = "point", size = 4, color = "blue") +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15) +
  labs(title = "Vidurkiai ir 95% PI pagal pareigas",
       x = "Pareigos", y = "Atlyginimas (USD tūkst.)") +
  mano_tema
```

```{r}
# ── Lytis
ggplot(data, aes(x = Gender, y = Salary)) +
  stat_summary(fun = mean, geom = "point", size = 4, color = "blue") +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15) +
  labs(title = "Vidurkiai ir 95% PI pagal lytį",
       x = "Lytis", y = "Atlyginimas (USD tūkst.)") +
  mano_tema
```

```{r}
# 95% PI (mean ± 1.96*SE)
mean_ci95 <- function(x, conf = 0.95) {
  x <- x[!is.na(x)]
  m  <- mean(x); se <- sd(x)/sqrt(length(x)); z <- qnorm(1-(1-conf)/2)
  data.frame(y = m, ymin = m - z*se, ymax = m + z*se)
}

# bendras "zoom" į 5–95 % atlyginimų intervalą (kad nebūtų "plokščios" kolonos)
ylims <- as.numeric(quantile(data$Salary, c(0.05, 0.95), na.rm = TRUE))

# ── Išsilavinimas: spalvos pagal kategoriją, rikiuota pagal vidurkį
ggplot(data, aes(x = reorder(Education, Salary, mean), y = Salary, fill = Education)) +
  stat_summary(fun = mean, geom = "point", size = 4, alpha = 0.9) +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15) +
  scale_fill_brewer(palette = "Set2") +
  coord_cartesian(ylim = ylims) +
  labs(title = "Vidurkiai ir 95% PI pagal išsilavinimą",
       x = "Išsilavinimas", y = "Atlyginimas (USD tūkst.)") +
  mano_tema +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 15, hjust = 1))
```

```{r}
# ── Vietovė: spalvos pagal kategoriją
ggplot(data, aes(x = reorder(Location, Salary, mean), y = Salary, fill = Location)) +
  stat_summary(fun = mean, geom = "point", size = 4, alpha = 0.9) +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15) +
  scale_fill_brewer(palette = "Pastel1") +
  coord_cartesian(ylim = ylims) +
  labs(title = "Vidurkiai ir 95% PI pagal vietovę",
       x = "Vietovė", y = "Atlyginimas (USD tūkst.)") +
  mano_tema +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 15, hjust = 1))
```

```{r}
# ── Pareigos: daug kategorijų → flip'intas grafikas, kad būtų skaitoma
ggplot(data, aes(x = reorder(Job_Title, Salary, mean), y = Salary, fill = Job_Title)) +
  stat_summary(fun = mean, geom = "point", size = 4, alpha = 0.9) +
  stat_summary(fun.data = mean_ci95, geom = "errorbar", width = 0.15) +
  scale_fill_brewer(palette = "Set3") +
  coord_cartesian(ylim = ylims) +
  labs(title = "Vidurkiai ir 95% PI pagal pareigas",
       x = "Pareigos", y = "Atlyginimas (USD tūkst.)") +
  mano_tema +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 30, hjust = 1))
```

```{r}
# ------------------- 6. Sklaidos diagramos -------------------
plot(data$Experience, data$Salary,
     col="steelblue", pch=19,
     main="Darbo patirtis ir atlyginimas",
     xlab="Darbo patirtis (m.)", ylab="Atlyginimas (USD tūkst.)")
abline(lm(Salary ~ Experience, data=data), col="red", lwd=2)
legend("topleft", legend=paste("Koreliacija:", round(cor(data$Experience, data$Salary),2)), bty="n")
```

```{r}
plot(data$Age, data$Salary,
     col="forestgreen", pch=19,
     main="Amžius ir atlyginimas",
     xlab="Amžius (m.)", ylab="Atlyginimas (USD tūkst.)")
abline(lm(Salary ~ Age, data=data), col="red", lwd=2)
legend("topleft", legend=paste("Koreliacija:", round(cor(data$Age, data$Salary),2)), bty="n")
```
